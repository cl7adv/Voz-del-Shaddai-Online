// ============== MODIFICACIONES EN EL SISTEMA ==============

class RadioOnlineSystem {
    constructor() {
        // ... (código existente)
        
        // Nuevas propiedades para el control de canciones y mensajes
        this.unplayedSongs = []; // Canciones no reproducidas
        this.currentPlaylist = []; // Playlist actual
        this.godMessageInterval = null; // Intervalo para mensajes
        this.messageElement = null; // Elemento para mostrar mensaje
        
        // Inicializar
        this.initShuffleSystem();
        this.createMessageElement();
        // ...
    }
    
    // ============== SISTEMA DE ALEATORIZACIÓN ==============
    initShuffleSystem() {
        // Esta función se llamará cada vez que se cargue una nueva lista
        this.unplayedSongs = [];
        this.currentPlaylist = [];
    }
    
    shuffleSongs(songs) {
        // Si es la primera vez o ya se reprodujeron todas, reiniciar
        if (this.unplayedSongs.length === 0) {
            this.unplayedSongs = [...songs];
            // Barajar aleatoriamente
            this.unplayedSongs.sort(() => Math.random() - 0.5);
        }
        
        // Tomar la siguiente canción no reproducida
        const nextSong = this.unplayedSongs.shift();
        this.currentPlaylist.push(nextSong);
        
        // Si ya no quedan canciones sin reproducir, reiniciar
        if (this.unplayedSongs.length === 0) {
            this.unplayedSongs = [...songs];
            this.unplayedSongs.sort(() => Math.random() - 0.5);
        }
        
        return nextSong;
    }
    
    // ============== SISTEMA DE MENSAJES ==============
    createMessageElement() {
        // Crear elemento para el mensaje
        this.messageElement = document.createElement('div');
        this.messageElement.className = 'god-message';
        this.messageElement.style.cssText = `
            position: fixed;
            top: 50%;
            left: 0;
            transform: translateY(-50%);
            color: gold;
            font-size: 24px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            white-space: nowrap;
            pointer-events: none;
            z-index: 10000;
            opacity: 0;
            transition: opacity 0.5s;
        `;
        document.body.appendChild(this.messageElement);
    }
    
    showGodMessage() {
        // Mensajes posibles (puedes personalizarlos)
        const messages = [
            "DIOS TE AMA",
            "JESÚS ES EL CAMINO",
            "LA PAZ ESTÉ CONTIGO",
            "DIOS ES AMOR",
            "CONFÍA EN EL SEÑOR",
            "BENDICIONES",
            "ALABADO SEA DIOS"
        ];
        
        // Seleccionar mensaje aleatorio
        const message = messages[Math.floor(Math.random() * messages.length)];
        this.messageElement.textContent = message;
        
        // Posición inicial (fuera de la pantalla a la izquierda)
        this.messageElement.style.left = '-500px';
        this.messageElement.style.opacity = '1';
        
        // Animar el cruce de pantalla
        let startTime = null;
        const duration = 4000; // 4 segundos
        
        const animate = (timestamp) => {
            if (!startTime) startTime = timestamp;
            const progress = timestamp - startTime;
            const percentage = Math.min(progress / duration, 1);
            
            // Mover de izquierda a derecha
            const screenWidth = window.innerWidth;
            const messageWidth = this.messageElement.offsetWidth;
            const position = -500 + (screenWidth + 500 + messageWidth) * percentage;
            
            this.messageElement.style.left = `${position}px`;
            
            if (percentage < 1) {
                requestAnimationFrame(animate);
            } else {
                // Desvanecer al final
                setTimeout(() => {
                    this.messageElement.style.opacity = '0';
                }, 500);
            }
        };
        
        requestAnimationFrame(animate);
    }
    
    // ============== MODIFICAR LA REPRODUCCIÓN ==============
    // Busca la función playNextSong() y modifícala:
    
    playNextSong() {
        if (this.songs.length === 0) return;
        
        // 1. Primero mostrar mensaje de Dios (si hay una canción anterior)
        if (this.currentSongIndex >= 0) {
            this.showGodMessage();
        }
        
        // 2. Esperar un momento antes de cambiar la canción
        setTimeout(() => {
            // Usar el sistema de aleatorización
            const nextSong = this.shuffleSongs(this.songs);
            this.currentSongIndex = this.songs.indexOf(nextSong);
            
            // Detener canción actual
            if (this.audio) {
                this.audio.pause();
                this.audio.src = '';
            }
            
            // Reproducir nueva canción
            this.playSong(nextSong);
            
            // Actualizar UI
            this.updateNowPlaying(nextSong);
            this.updatePlayPauseButton(true);
            
        }, 2000); // Esperar 2 segundos después del mensaje
    }
    
    // También modificar la función playSong():
    playSong(song) {
        // ... (código existente de playSong)
        
        // Cuando la canción termine, reproducir la siguiente
        this.audio.onended = () => {
            this.playNextSong();
        };
    }
    
    // ============== ESTILOS ADICIONALES ==============
    // Agrega estos estilos en el CSS:
    /*
    .god-message {
        font-family: 'Arial Black', sans-serif;
        animation: glow 2s ease-in-out infinite alternate;
    }
    
    @keyframes glow {
        from {
            text-shadow: 0 0 10px gold, 0 0 20px gold, 0 0 30px orange;
        }
        to {
            text-shadow: 0 0 20px gold, 0 0 30px orange, 0 0 40px red;
        }
    }
    */
}

// ============== INICIAR SISTEMA ==============
document.addEventListener('DOMContentLoaded', () => {
    window.radioSystem = new RadioOnlineSystem();
});
