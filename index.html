<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> Voz del Shaddai Radio - Emisora Online Continua</title>
    
    <!-- Meta Tags -->
    <meta name="description" content=" Emisora Cristiana Online - Reproducci贸n continua sin interrupciones. Crossfade profesional para una experiencia perfecta.">
    
    <!-- Estilos y Fuentes -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
          integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
          crossorigin="anonymous" referrerpolicy="no-referrer">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
    
    <!-- Favicon en base64 -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22></text></svg>">
    
    <style>
        /* ===== VARIABLES Y RESET ===== */
        :root {
            --primary: #1a73e8;
            --primary-dark: #0d47a1;
            --primary-light: #4285f4;
            --secondary: #ea4335;
            --accent: #fbbc05;
            --success: #34a853;
            --dark: #202124;
            --darker: #171717;
            --light: #ffffff;
            --gray: #9aa0a6;
            
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.2);
            --radius: 16px;
            
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, var(--darker) 0%, var(--dark) 100%);
            color: var(--light);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* ===== LOADING SCREEN ===== */
        #loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--darker);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease;
        }

        .loading-content {
            text-align: center;
            max-width: 500px;
            padding: 2rem;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border-top-color: var(--primary-light);
            animation: spin 1s linear infinite;
            margin: 0 auto 2rem;
        }

        @keyframes spin {
            100% { transform: rotate(360deg); }
        }

        /* ===== MAIN APP ===== */
        #app {
            display: none;
            min-height: 100vh;
            padding: 1rem;
            max-width: 800px;
            margin: 0 auto;
        }

        .app-loaded {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* ===== HEADER ===== */
        .radio-header {
            background: rgba(32, 33, 36, 0.9);
            backdrop-filter: blur(10px);
            border-radius: var(--radius);
            padding: 2rem;
            margin-bottom: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: var(--shadow);
            text-align: center;
        }

        .radio-brand {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1.5rem;
        }

        .radio-logo {
            width: 120px;
            height: 120px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            box-shadow: var(--shadow-lg);
            animation: pulse 2s infinite;
            position: relative;
        }

        .radio-logo::after {
            content: '';
            position: absolute;
            top: -10px;
            left: -10px;
            right: -10px;
            bottom: -10px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            animation: pulse-ring 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes pulse-ring {
            0% { transform: scale(0.8); opacity: 1; }
            100% { transform: scale(1.3); opacity: 0; }
        }

        .radio-info h1 {
            font-family: 'Montserrat', sans-serif;
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--light);
            margin-bottom: 0.5rem;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .radio-tagline {
            color: var(--gray);
            font-size: 1.1rem;
            margin-bottom: 1rem;
        }

        /* ===== BROADCAST INFO ===== */
        .broadcast-info {
            background: rgba(32, 33, 36, 0.9);
            backdrop-filter: blur(10px);
            border-radius: var(--radius);
            padding: 1.5rem;
            margin-bottom: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: var(--shadow);
            text-align: center;
        }

        .broadcast-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-top: 1rem;
        }

        .stat-item {
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--gray);
            margin-bottom: 0.25rem;
        }

        .stat-value {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--light);
        }

        /* ===== NOW PLAYING ===== */
        .now-playing-card {
            background: linear-gradient(135deg, rgba(26, 115, 232, 0.2), rgba(234, 67, 53, 0.2));
            border-radius: var(--radius);
            padding: 2.5rem 2rem;
            margin-bottom: 2rem;
            position: relative;
            overflow: hidden;
            text-align: center;
        }

        .now-playing-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.05) 50%, transparent 70%);
            animation: shine 3s infinite linear;
        }

        @keyframes shine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .track-display {
            position: relative;
            z-index: 1;
        }

        .album-art-container {
            width: 180px;
            height: 180px;
            margin: 0 auto 1.5rem;
            position: relative;
        }

        .album-art {
            width: 100%;
            height: 100%;
            border-radius: 12px;
            background: linear-gradient(135deg, var(--primary-dark), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
            box-shadow: var(--shadow-lg);
            animation: rotate 20s linear infinite;
            animation-play-state: paused;
        }

        .album-art.playing {
            animation-play-state: running;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .album-art::after {
            content: '';
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            bottom: 10px;
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
        }

        .track-info {
            margin-top: 1.5rem;
        }

        .track-title {
            font-size: 2.2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            line-height: 1.2;
            color: var(--light);
            min-height: 3rem;
        }

        .track-artist {
            color: var(--primary-light);
            font-size: 1.4rem;
            margin-bottom: 1.5rem;
            min-height: 2rem;
        }

        .track-meta {
            display: flex;
            justify-content: center;
            gap: 2rem;
            color: var(--gray);
            font-size: 1.1rem;
            margin-top: 1rem;
        }

        /* ===== CROSSFADE INDICATOR ===== */
        .crossfade-section {
            background: rgba(32, 33, 36, 0.9);
            backdrop-filter: blur(10px);
            border-radius: var(--radius);
            padding: 1.5rem;
            margin-bottom: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: var(--shadow);
        }

        .crossfade-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--light);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .crossfade-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            color: var(--gray);
            font-size: 0.9rem;
        }

        .crossfade-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            position: relative;
            margin: 1rem 0;
        }

        .crossfade-progress {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            width: 0%;
            border-radius: 4px;
            transition: width 0.1s linear;
        }

        .crossfade-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 0.5rem;
            font-size: 0.9rem;
            color: var(--gray);
        }

        /* ===== PROGRESS BAR ===== */
        .progress-section {
            background: rgba(32, 33, 36, 0.9);
            backdrop-filter: blur(10px);
            border-radius: var(--radius);
            padding: 1.5rem;
            margin-bottom: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: var(--shadow);
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            color: var(--gray);
            font-size: 1rem;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 0.5rem;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--primary-light));
            width: 0%;
            border-radius: 5px;
            transition: width 0.1s linear;
        }

        /* ===== RADIO CONTROLS ===== */
        .radio-controls {
            background: rgba(32, 33, 36, 0.9);
            backdrop-filter: blur(10px);
            border-radius: var(--radius);
            padding: 2rem;
            margin-bottom: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: var(--shadow);
        }

        .controls-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2rem;
        }

        .power-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
        }

        .power-btn {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: none;
            background: linear-gradient(135deg, var(--success), #2e7d32);
            color: white;
            font-size: 2.5rem;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-lg);
            position: relative;
            overflow: hidden;
        }

        .power-btn:hover {
            transform: scale(1.05);
        }

        .power-btn.off {
            background: linear-gradient(135deg, var(--secondary), #c62828);
        }

        .power-btn::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .power-btn:hover::after {
            opacity: 1;
        }

        .volume-section {
            width: 100%;
            max-width: 400px;
        }

        .volume-display {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            width: 100%;
            margin-bottom: 1rem;
        }

        .volume-icon {
            font-size: 2rem;
            color: var(--primary-light);
            width: 60px;
            text-align: center;
        }

        .volume-slider {
            flex: 1;
            height: 12px;
            -webkit-appearance: none;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            outline: none;
        }

        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            border: 4px solid var(--light);
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        .volume-value {
            width: 70px;
            text-align: center;
            font-weight: 700;
            font-size: 1.5rem;
            color: var(--primary-light);
            background: rgba(0,0,0,0.3);
            padding: 0.5rem;
            border-radius: 8px;
        }

        /* ===== BOTN ALEATORIO ===== */
        .shuffle-section {
            display: flex;
            justify-content: center;
            margin-top: 1rem;
        }

        .shuffle-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid var(--primary);
            color: var(--primary-light);
            padding: 0.8rem 2rem;
            border-radius: 25px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.8rem;
            font-weight: 600;
            transition: var(--transition);
        }

        .shuffle-btn:hover {
            background: var(--primary);
            color: white;
        }

        .shuffle-btn.active {
            background: var(--primary);
            color: white;
        }

        /* ===== NEXT TRACK ===== */
        .next-track-section {
            background: rgba(32, 33, 36, 0.9);
            backdrop-filter: blur(10px);
            border-radius: var(--radius);
            padding: 1.5rem;
            margin-bottom: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: var(--shadow);
        }

        .next-track-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--light);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .next-track-info {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }

        .next-track-name {
            font-size: 1.2rem;
            font-weight: 500;
            color: var(--light);
        }

        .next-track-time {
            font-size: 1rem;
            color: var(--gray);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* ===== STATUS INDICATORS ===== */
        .status-indicator {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 600;
            margin: 0 auto;
            max-width: 200px;
        }

        .status-online {
            background: rgba(52, 168, 83, 0.2);
            color: var(--success);
            border: 2px solid rgba(52, 168, 83, 0.4);
            animation: pulse-status 2s infinite;
        }

        .status-offline {
            background: rgba(234, 67, 53, 0.2);
            color: var(--secondary);
            border: 2px solid rgba(234, 67, 53, 0.4);
        }

        @keyframes pulse-status {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* ===== NOTIFICATION ===== */
        .notification {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: var(--dark);
            border-left: 4px solid var(--primary);
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            gap: 1rem;
            transform: translateX(120%);
            transition: transform 0.3s ease;
            z-index: 1000;
            max-width: 400px;
        }

        .notification.show {
            transform: translateX(0);
        }

        /* ===== FOOTER ===== */
        .radio-footer {
            text-align: center;
            padding: 2rem;
            color: var(--gray);
            font-size: 0.9rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            margin-top: 2rem;
        }

        /* ===== RESPONSIVE ADJUSTMENTS ===== */
        @media (max-width: 768px) {
            .radio-logo {
                width: 100px;
                height: 100px;
                font-size: 2.5rem;
            }
            
            .radio-info h1 {
                font-size: 2rem;
            }
            
            .album-art-container {
                width: 150px;
                height: 150px;
            }
            
            .album-art {
                font-size: 3rem;
            }
            
            .track-title {
                font-size: 1.8rem;
            }
            
            .track-artist {
                font-size: 1.2rem;
            }
            
            .broadcast-stats {
                grid-template-columns: 1fr;
                gap: 0.75rem;
            }
            
            .volume-display {
                gap: 1rem;
            }
            
            .volume-slider {
                height: 10px;
            }
        }

        @media (max-width: 480px) {
            .radio-logo {
                width: 80px;
                height: 80px;
                font-size: 2rem;
            }
            
            .radio-info h1 {
                font-size: 1.8rem;
            }
            
            .album-art-container {
                width: 120px;
                height: 120px;
            }
            
            .album-art {
                font-size: 2.5rem;
            }
            
            .track-title {
                font-size: 1.5rem;
            }
            
            .power-btn {
                width: 80px;
                height: 80px;
                font-size: 2rem;
            }
            
            .volume-icon {
                font-size: 1.5rem;
                width: 40px;
            }
            
            .volume-value {
                font-size: 1.2rem;
                width: 60px;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <h1 style="font-family: 'Montserrat', sans-serif; font-size: 2.5rem; color: white; margin-bottom: 1rem;">
                VOZ DEL SHADDAI
            </h1>
            <p style="color: var(--gray); margin-bottom: 2rem;">Iniciando emisora online...</p>
            <div id="loading-details" style="color: var(--gray);"></div>
        </div>
    </div>

    <!-- Main App -->
    <div id="app">
        <!-- Header -->
        <header class="radio-header">
            <div class="radio-brand">
                <div class="radio-logo">
                    <i class="fas fa-broadcast-tower"></i>
                </div>
                <div class="radio-info">
                    <h1>VOZ DEL SHADDAI RADIO</h1>
                    <p class="radio-tagline">Emisora Cristiana Online - Reproducci贸n Continua</p>
                    <div class="status-indicator status-online" id="broadcast-status">
                        <i class="fas fa-circle" style="font-size: 0.8rem;"></i>
                        <span>TRANSMITIENDO EN VIVO</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Broadcast Info -->
        <section class="broadcast-info">
            <div style="font-size: 1.1rem; color: var(--gray); margin-bottom: 0.5rem;">
                <i class="fas fa-satellite-dish"></i> Emisora Online - Solo Escucha
            </div>
            <div class="broadcast-stats">
                <div class="stat-item">
                    <div class="stat-label">CANCIONES EN LISTA</div>
                    <div class="stat-value" id="total-tracks">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">TIEMPO TRANSMITIENDO</div>
                    <div class="stat-value" id="broadcast-time">00:00</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">PRXIMA CANCIN</div>
                    <div class="stat-value" id="next-in">--:--</div>
                </div>
            </div>
        </section>

        <!-- Now Playing -->
        <section class="now-playing-card">
            <div class="track-display">
                <div class="album-art-container">
                    <div class="album-art" id="album-art">
                        <i class="fas fa-music"></i>
                    </div>
                </div>
                <div class="track-info">
                    <h2 class="track-title" id="track-title">Sintonizando emisora...</h2>
                    <p class="track-artist" id="track-artist">
                        Voz del Shaddai Radio
                    </p>
                    <div class="track-meta">
                        <span id="current-time">00:00</span>
                        <span id="track-duration">00:00</span>
                        <span id="time-remaining">-00:00</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Crossfade Indicator -->
        <section class="crossfade-section">
            <div class="crossfade-title">
                <i class="fas fa-exchange-alt"></i> Transici贸n Autom谩tica
            </div>
            <div class="crossfade-info">
                <span id="current-fade-status">Sistema de crossfade activo</span>
                <span id="fade-duration">Duraci贸n: 4 segundos</span>
            </div>
            <div class="crossfade-bar">
                <div class="crossfade-progress" id="crossfade-progress"></div>
            </div>
            <div class="crossfade-labels">
                <span>Canci贸n actual</span>
                <span id="fade-percentage">0%</span>
                <span>Siguiente canci贸n</span>
            </div>
        </section>

        <!-- Progress Bar -->
        <section class="progress-section">
            <div class="progress-info">
                <span id="progress-current">00:00</span>
                <span id="progress-total">00:00</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill"></div>
            </div>
            <div style="text-align: center; margin-top: 0.5rem; font-size: 0.9rem; color: var(--gray);">
                <span id="next-change">Pr贸ximo cambio autom谩tico en: --:--</span>
            </div>
        </section>

        <!-- Radio Controls -->
        <section class="radio-controls">
            <div class="controls-group">
                <div class="power-section">
                    <button class="power-btn" id="power-btn" title="Encender/Apagar radio">
                        <i class="fas fa-power-off"></i>
                    </button>
                    <span style="color: var(--gray); font-size: 1rem;">ENCENDER / APAGAR</span>
                </div>
                
                <div class="volume-section">
                    <div class="volume-display">
                        <div class="volume-icon">
                            <i class="fas fa-volume-up" id="volume-icon"></i>
                        </div>
                        <input type="range" class="volume-slider" id="volume-slider" min="0" max="100" value="70">
                        <div class="volume-value" id="volume-value">70%</div>
                    </div>
                    <span style="color: var(--gray); font-size: 1rem; text-align: center; display: block;">CONTROL DE VOLUMEN</span>
                </div>

                <div class="shuffle-section">
                    <button class="shuffle-btn" id="shuffle-btn" title="Activar/Desactivar reproducci贸n aleatoria">
                        <i class="fas fa-random"></i>
                        <span id="shuffle-text">ALEATORIO: ON</span>
                    </button>
                </div>
            </div>
        </section>

        <!-- Next Track -->
        <section class="next-track-section">
            <div class="next-track-title">
                <i class="fas fa-forward"></i> Pr贸xima Canci贸n
            </div>
            <div class="next-track-info">
                <div class="next-track-name" id="next-track-name">Cargando siguiente canci贸n...</div>
                <div class="next-track-time">
                    <i class="far fa-clock"></i>
                    <span id="next-track-time">En --:--</span>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="radio-footer">
            <p> Voz del Shaddai Radio - Emisora Online Continua</p>
            <p style="margin-top: 0.5rem; font-size: 0.8rem;">
                Reproducci贸n autom谩tica sin interrupciones 路 Transiciones suaves con crossfade profesional
            </p>
            <p style="margin-top: 0.5rem; font-size: 0.7rem; color: var(--primary-light);">
                Modo Aleatorio Activado 路 Las canciones se reproducen en orden aleatorio
            </p>
        </footer>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification">
        <i class="fas fa-info-circle"></i>
        <div>
            <strong id="notification-title">Notificaci贸n</strong>
            <p id="notification-message">Mensaje de notificaci贸n</p>
        </div>
    </div>

    <script>
        // ============== SISTEMA DE RADIO ONLINE - MODO EMISORA ==============
        class RadioOnlineSystem {
            constructor() {
                // Configuraci贸n del sistema
                this.config = {
                    // Informaci贸n del repositorio
                    githubUser: 'cl7adv',
                    repo: 'Voz-del-Shaddai-Online',
                    musicFolder: 'musica',
                    branch: 'main',
                    
                    // URLs para GitHub
                    githubApi: 'https://api.github.com',
                    githubRaw: 'https://raw.githubusercontent.com',
                    
                    // Configuraci贸n de crossfade (PRIORIDAD)
                    crossfadeDuration: 4000, // 4 segundos para transici贸n m谩s suave
                    fadeStartPercentage: 85, // Iniciar fade m谩s temprano para evitar cortes
                    fadeCurve: 'easeInOut',
                    
                    // Sistema de reproducci贸n
                    defaultVolume: 0.7,
                    autoStart: true, // Comienza a reproducir autom谩ticamente
                    
                    // Control de tiempo
                    updateInterval: 100, // Actualizar UI cada 100ms
                    spectrumUpdate: 60, // Actualizar espectro cada 60ms
                    
                    // Tiempo de buffer
                    preloadBuffer: 5000, // Pre-cargar 5 segundos antes
                    
                    // Modo aleatorio (NUEVO)
                    shuffleMode: true // Activar reproducci贸n aleatoria por defecto
                };

                // Estado del sistema
                this.state = {
                    // Lista de reproducci贸n
                    tracks: [],
                    currentTrackIndex: 0,
                    nextTrackIndex: 1,
                    
                    // Estado de reproducci贸n
                    isPlaying: false,
                    isPoweredOn: true,
                    volume: this.config.defaultVolume,
                    
                    // Sistema de crossfade
                    isCrossfading: false,
                    crossfadeProgress: 0,
                    currentAudio: null,
                    nextAudio: null,
                    fadeInterval: null,
                    
                    // Temporizadores
                    trackStartTime: 0,
                    nextTrackTimer: null,
                    preloadTimer: null,
                    broadcastTimer: null,
                    broadcastStartTime: Date.now(),
                    
                    // Elementos de audio
                    audioElements: [],
                    
                    // Estad铆sticas
                    totalPlayTime: 0,
                    tracksPlayed: 0,
                    
                    // Sistema de aleatoriedad (NUEVO)
                    shuffleHistory: [] // Historial de canciones ya reproducidas
                };

                // Inicializar
                this.init();
            }

            async init() {
                this.cacheElements();
                this.setupEventListeners();
                await this.loadTracksFromGitHub();
                this.createAudioElements();
                this.startSystem();
                this.hideLoadingScreen();
                this.updateShuffleButton();
            }

            cacheElements() {
                this.elements = {
                    loadingScreen: document.getElementById('loading-screen'),
                    loadingDetails: document.getElementById('loading-details'),
                    app: document.getElementById('app'),
                    
                    // Informaci贸n de emisora
                    broadcastStatus: document.getElementById('broadcast-status'),
                    totalTracks: document.getElementById('total-tracks'),
                    broadcastTime: document.getElementById('broadcast-time'),
                    nextIn: document.getElementById('next-in'),
                    
                    // Informaci贸n de canci贸n
                    trackTitle: document.getElementById('track-title'),
                    trackArtist: document.getElementById('track-artist'),
                    albumArt: document.getElementById('album-art'),
                    currentTime: document.getElementById('current-time'),
                    trackDuration: document.getElementById('track-duration'),
                    timeRemaining: document.getElementById('time-remaining'),
                    
                    // Progress
                    progressFill: document.getElementById('progress-fill'),
                    progressCurrent: document.getElementById('progress-current'),
                    progressTotal: document.getElementById('progress-total'),
                    nextChange: document.getElementById('next-change'),
                    
                    // Crossfade
                    crossfadeProgress: document.getElementById('crossfade-progress'),
                    fadePercentage: document.getElementById('fade-percentage'),
                    currentFadeStatus: document.getElementById('current-fade-status'),
                    fadeDuration: document.getElementById('fade-duration'),
                    
                    // Next track
                    nextTrackName: document.getElementById('next-track-name'),
                    nextTrackTime: document.getElementById('next-track-time'),
                    
                    // Controls
                    powerBtn: document.getElementById('power-btn'),
                    volumeSlider: document.getElementById('volume-slider'),
                    volumeValue: document.getElementById('volume-value'),
                    volumeIcon: document.getElementById('volume-icon'),
                    shuffleBtn: document.getElementById('shuffle-btn'),
                    shuffleText: document.getElementById('shuffle-text'),
                    
                    // Notification
                    notification: document.getElementById('notification'),
                    notificationTitle: document.getElementById('notification-title'),
                    notificationMessage: document.getElementById('notification-message')
                };
            }

            setupEventListeners() {
                // Control de encendido/apagado
                this.elements.powerBtn.addEventListener('click', () => this.togglePower());
                
                // Control de volumen
                this.elements.volumeSlider.addEventListener('input', (e) => {
                    this.setVolume(e.target.value / 100);
                });
                
                // Control de modo aleatorio (NUEVO)
                this.elements.shuffleBtn.addEventListener('click', () => this.toggleShuffleMode());
                
                // Actualizar UI peri贸dicamente
                setInterval(() => this.updateUI(), this.config.updateInterval);
                
                // Actualizar tiempo de transmisi贸n
                setInterval(() => this.updateBroadcastTime(), 1000);
            }

            // ============== SISTEMA DE REPRODUCCIN ALEATORIA (NUEVO) ==============
            getRandomTrackIndex() {
                if (this.state.tracks.length <= 1) return 0;
                
                // Evitar repetir la misma canci贸n
                let randomIndex;
                let attempts = 0;
                const maxAttempts = 20; // Evitar bucle infinito
                
                do {
                    randomIndex = Math.floor(Math.random() * this.state.tracks.length);
                    attempts++;
                    
                    // Si hemos intentado muchas veces, permitir cualquier canci贸n
                    if (attempts >= maxAttempts) {
                        break;
                    }
                } while (
                    randomIndex === this.state.currentTrackIndex || 
                    this.state.shuffleHistory.includes(randomIndex)
                );
                
                // Mantener historial de 煤ltimas 10 canciones
                this.state.shuffleHistory.push(randomIndex);
                if (this.state.shuffleHistory.length > 10) {
                    this.state.shuffleHistory.shift();
                }
                
                return randomIndex;
            }

            getNextTrackIndex() {
                if (this.config.shuffleMode) {
                    return this.getRandomTrackIndex();
                } else {
                    return (this.state.currentTrackIndex + 1) % this.state.tracks.length;
                }
            }

            toggleShuffleMode() {
                this.config.shuffleMode = !this.config.shuffleMode;
                this.updateShuffleButton();
                
                if (this.config.shuffleMode) {
                    this.showNotification('Modo aleatorio activado', 'Las canciones se reproducir谩n en orden aleatorio', 'info');
                    
                    // Si ya hay canciones, actualizar la siguiente canci贸n a una aleatoria
                    if (this.state.tracks.length > 0) {
                        this.state.nextTrackIndex = this.getRandomTrackIndex();
                        if (this.state.nextAudio) {
                            const nextTrack = this.state.tracks[this.state.nextTrackIndex];
                            this.state.nextAudio.src = nextTrack.url;
                            this.elements.nextTrackName.textContent = nextTrack.name;
                        }
                    }
                } else {
                    this.showNotification('Modo secuencial activado', 'Las canciones se reproducir谩n en orden', 'info');
                    
                    // Actualizar siguiente canci贸n al siguiente 铆ndice secuencial
                    if (this.state.tracks.length > 0) {
                        this.state.nextTrackIndex = (this.state.currentTrackIndex + 1) % this.state.tracks.length;
                        if (this.state.nextAudio) {
                            const nextTrack = this.state.tracks[this.state.nextTrackIndex];
                            this.state.nextAudio.src = nextTrack.url;
                            this.elements.nextTrackName.textContent = nextTrack.name;
                        }
                    }
                }
            }

            updateShuffleButton() {
                if (this.config.shuffleMode) {
                    this.elements.shuffleBtn.classList.add('active');
                    this.elements.shuffleText.textContent = 'ALEATORIO: ON';
                } else {
                    this.elements.shuffleBtn.classList.remove('active');
                    this.elements.shuffleText.textContent = 'ALEATORIO: OFF';
                }
            }

            // ============== CARGA DE CANCIONES DESDE GITHUB ==============
            async loadTracksFromGitHub() {
                try {
                    this.updateLoadingStatus('Conectando con el servidor de m煤sica...');
                    
                    const apiUrl = `${this.config.githubApi}/repos/${this.config.githubUser}/${this.config.repo}/contents/${this.config.musicFolder}`;
                    
                    const response = await fetch(apiUrl);
                    
                    if (!response.ok) {
                        throw new Error(`Error al conectar con GitHub: ${response.status}`);
                    }
                    
                    const files = await response.json();
                    
                    // Filtrar solo archivos MP3
                    const mp3Files = files.filter(file => 
                        file.type === 'file' && 
                        file.name.toLowerCase().endsWith('.mp3')
                    );
                    
                    if (mp3Files.length === 0) {
                        throw new Error('No se encontraron canciones MP3');
                    }
                    
                    // Crear lista de canciones
                    this.state.tracks = mp3Files.map((file, index) => ({
                        id: index,
                        name: this.formatTrackName(file.name),
                        filename: file.name,
                        url: `${this.config.githubRaw}/${this.config.githubUser}/${this.config.repo}/${this.config.branch}/${this.config.musicFolder}/${encodeURIComponent(file.name)}`,
                        size: file.size,
                        artist: 'Voz del Shaddai',
                        duration: null
                    }));
                    
                    // Actualizar estad铆sticas
                    this.elements.totalTracks.textContent = this.state.tracks.length;
                    
                    this.updateLoadingStatus(`Se encontraron ${this.state.tracks.length} canciones`);
                    this.showNotification('Lista cargada', `${this.state.tracks.length} canciones disponibles`, 'success');
                    
                } catch (error) {
                    console.error('Error cargando canciones:', error);
                    this.showNotification('Modo offline', 'Usando lista de demostraci贸n', 'warning');
                    this.loadFallbackTracks();
                }
            }

            formatTrackName(filename) {
                // Limpiar nombre del archivo para mostrar
                let name = filename.replace('.mp3', '');
                name = name.replace(/[_\-]/g, ' ');
                name = name.split(' ')
                    .map(word => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase())
                    .join(' ');
                return name;
            }

            loadFallbackTracks() {
                // Canciones de demostraci贸n como fallback
                this.state.tracks = [
                    {
                        id: 0,
                        name: 'Alabanza en el Esp铆ritu',
                        filename: 'alabanza.mp3',
                        url: 'https://assets.mixkit.co/music/preview/mixkit-tech-house-vibes-130.mp3',
                        size: 3200000,
                        artist: 'Voz del Shaddai',
                        duration: null
                    },
                    {
                        id: 1,
                        name: 'C谩nticos de Adoraci贸n',
                        filename: 'adoracion.mp3',
                        url: 'https://assets.mixkit.co/music/preview/mixkit-driving-ambition-32.mp3',
                        size: 2800000,
                        artist: 'Coros Celestiales',
                        duration: null
                    },
                    {
                        id: 2,
                        name: 'Gloria al Alt铆simo',
                        filename: 'gloria.mp3',
                        url: 'https://assets.mixkit.co/music/preview/mixkit-deep-urban-623.mp3',
                        size: 3500000,
                        artist: 'Alabanza Eterna',
                        duration: null
                    },
                    {
                        id: 3,
                        name: 'Himnos de Fe',
                        filename: 'himnos.mp3',
                        url: 'https://assets.mixkit.co/music/preview/mixkit-inspiring-epic-achievement-947.mp3',
                        size: 3000000,
                        artist: 'Coros de Adoraci贸n',
                        duration: null
                    },
                    {
                        id: 4,
                        name: 'Alabanza Celestial',
                        filename: 'celestial.mp3',
                        url: 'https://assets.mixkit.co/music/preview/mixkit-intense-epic-trailer-1558.mp3',
                        size: 2800000,
                        artist: 'Voz del Shaddai',
                        duration: null
                    }
                ];
                
                this.elements.totalTracks.textContent = this.state.tracks.length;
            }

            // ============== SISTEMA DE AUDIO Y CROSSFADE ==============
            createAudioElements() {
                // Crear elementos de audio (solo 2 para crossfade)
                this.state.currentAudio = new Audio();
                this.state.currentAudio.crossOrigin = "anonymous";
                this.state.currentAudio.preload = "auto";
                this.state.currentAudio.volume = this.state.volume;
                
                this.state.nextAudio = new Audio();
                this.state.nextAudio.crossOrigin = "anonymous";
                this.state.nextAudio.preload = "auto";
                this.state.nextAudio.volume = 0; // Inicia en 0 para crossfade
                
                // Configurar eventos
                this.setupAudioEvents(this.state.currentAudio, 'current');
                this.setupAudioEvents(this.state.nextAudio, 'next');
            }

            setupAudioEvents(audio, type) {
                audio.addEventListener('loadedmetadata', () => this.onTrackLoaded(type));
                audio.addEventListener('error', (e) => this.onAudioError(e, type));
                audio.addEventListener('ended', () => this.onTrackEnded(type));
                audio.addEventListener('canplay', () => this.onCanPlay(type));
            }

            // ============== SISTEMA PRINCIPAL DE REPRODUCCIN ==============
            async startSystem() {
                if (this.state.tracks.length === 0) {
                    this.showNotification('Error', 'No hay canciones disponibles', 'error');
                    return;
                }
                
                // ESTABLECER NDICES ALEATORIOS AL INICIAR (si el modo aleatorio est谩 activado)
                if (this.config.shuffleMode) {
                    this.state.currentTrackIndex = this.getRandomTrackIndex();
                    
                    // Obtener siguiente canci贸n aleatoria (diferente a la actual)
                    do {
                        this.state.nextTrackIndex = this.getRandomTrackIndex();
                    } while (this.state.nextTrackIndex === this.state.currentTrackIndex);
                }
                
                // Cargar primera canci贸n
                await this.loadTrack(this.state.currentTrackIndex, 'current');
                
                // Cargar siguiente canci贸n
                await this.loadTrack(this.state.nextTrackIndex, 'next');
                
                // Iniciar reproducci贸n si est谩 configurado
                if (this.config.autoStart && this.state.isPoweredOn) {
                    setTimeout(() => {
                        this.playCurrentTrack();
                    }, 1000);
                }
            }

            async loadTrack(trackIndex, type) {
                if (trackIndex < 0 || trackIndex >= this.state.tracks.length) return;
                
                const track = this.state.tracks[trackIndex];
                const audio = type === 'current' ? this.state.currentAudio : this.state.nextAudio;
                
                try {
                    audio.src = track.url;
                    await audio.load();
                    
                    if (type === 'current') {
                        // Actualizar informaci贸n de la canci贸n actual
                        this.updateTrackInfo(track);
                    } else if (type === 'next') {
                        // Actualizar informaci贸n de la siguiente canci贸n
                        this.elements.nextTrackName.textContent = track.name;
                    }
                    
                } catch (error) {
                    console.error(`Error cargando ${type} track:`, error);
                }
            }

            updateTrackInfo(track) {
                this.elements.trackTitle.textContent = track.name;
                this.elements.trackArtist.textContent = track.artist;
                
                // Actualizar colores del 谩lbum
                this.updateAlbumArtColors();
                
                // Actualizar estad铆sticas
                this.state.tracksPlayed++;
            }

            // ============== CROSSFADE PROFESIONAL ==============
            async playCurrentTrack() {
                if (!this.state.isPoweredOn || this.state.tracks.length === 0) return;
                
                try {
                    // Iniciar reproducci贸n
                    await this.state.currentAudio.play();
                    this.state.isPlaying = true;
                    this.state.trackStartTime = Date.now();
                    
                    // Actualizar UI
                    this.elements.powerBtn.classList.remove('off');
                    this.elements.albumArt.classList.add('playing');
                    this.elements.broadcastStatus.className = 'status-indicator status-online';
                    this.elements.broadcastStatus.innerHTML = '<i class="fas fa-circle" style="font-size: 0.8rem;"></i><span>TRANSMITIENDO EN VIVO</span>';
                    
                    // Programar crossfade
                    this.scheduleCrossfade();
                    
                    this.showNotification('Emisora activa', 'Reproducci贸n continua iniciada', 'success');
                    
                } catch (error) {
                    console.error('Error al reproducir:', error);
                    this.state.isPlaying = false;
                    
                    // Intentar con siguiente canci贸n
                    setTimeout(() => {
                        this.nextTrack();
                    }, 2000);
                }
            }

            scheduleCrossfade() {
                // Limpiar temporizadores anteriores
                if (this.state.nextTrackTimer) clearTimeout(this.state.nextTrackTimer);
                if (this.state.preloadTimer) clearTimeout(this.state.preloadTimer);
                
                const currentAudio = this.state.currentAudio;
                const duration = currentAudio.duration || 180; // 3 minutos por defecto
                
                // Calcular tiempo para iniciar crossfade
                const fadeStartTime = (duration * (this.config.fadeStartPercentage / 100)) * 1000;
                const timeUntilFade = fadeStartTime - this.config.crossfadeDuration;
                
                // Programar inicio de crossfade
                this.state.nextTrackTimer = setTimeout(() => {
                    this.startCrossfade();
                }, Math.max(0, timeUntilFade));
                
                // Programar pre-carga de siguiente canci贸n
                const preloadTime = Math.max(0, timeUntilFade - this.config.preloadBuffer);
                this.state.preloadTimer = setTimeout(() => {
                    if (!this.state.isCrossfading) {
                        this.state.nextAudio.load();
                    }
                }, preloadTime);
                
                // Actualizar UI con tiempo del pr贸ximo cambio
                this.updateNextChangeTime(timeUntilFade);
            }

            async startCrossfade() {
                if (this.state.isCrossfading || !this.state.isPoweredOn) return;
                
                console.log('Iniciando crossfade profesional...');
                this.state.isCrossfading = true;
                this.elements.currentFadeStatus.textContent = 'Transici贸n en progreso...';
                
                const startTime = Date.now();
                const duration = this.config.crossfadeDuration;
                
                // Detener temporizador anterior
                if (this.state.fadeInterval) {
                    clearInterval(this.state.fadeInterval);
                }
                
                // Iniciar reproducci贸n de la siguiente canci贸n
                try {
                    await this.state.nextAudio.play();
                } catch (error) {
                    console.error('Error iniciando siguiente canci贸n:', error);
                }
                
                // Fade out de la canci贸n actual y fade in de la siguiente
                const startVolume = this.state.volume;
                
                this.state.fadeInterval = setInterval(() => {
                    const elapsed = Date.now() - startTime;
                    const progress = Math.min(elapsed / duration, 1);
                    
                    // Actualizar progreso visual
                    this.state.crossfadeProgress = progress;
                    this.elements.crossfadeProgress.style.width = (progress * 100) + '%';
                    this.elements.fadePercentage.textContent = Math.round(progress * 100) + '%';
                    
                    // Aplicar curva de fade suave
                    const fadeOut = this.easeInOutCubic(progress);
                    const fadeIn = this.easeInOutQuad(progress);
                    
                    // Crossfade: bajar volumen actual, subir volumen siguiente
                    if (this.state.currentAudio) {
                        this.state.currentAudio.volume = Math.max(0, startVolume * (1 - fadeOut));
                    }
                    
                    if (this.state.nextAudio) {
                        this.state.nextAudio.volume = Math.min(this.state.volume, this.state.volume * fadeIn);
                    }
                    
                    // Completar crossfade
                    if (progress >= 1) {
                        clearInterval(this.state.fadeInterval);
                        this.completeCrossfade();
                    }
                    
                }, 16); // ~60fps
            }

            easeInOutCubic(x) {
                return x < 0.5 ? 4 * x * x * x : 1 - Math.pow(-2 * x + 2, 3) / 2;
            }

            easeInOutQuad(x) {
                return x < 0.5 ? 2 * x * x : 1 - Math.pow(-2 * x + 2, 2) / 2;
            }

            completeCrossfade() {
                console.log('Crossfade completado sin cortes');
                
                // Detener canci贸n actual completamente
                if (this.state.currentAudio) {
                    this.state.currentAudio.pause();
                    this.state.currentAudio.currentTime = 0;
                    this.state.currentAudio.volume = 0;
                }
                
                // Cambiar referencias
                const oldCurrent = this.state.currentAudio;
                this.state.currentAudio = this.state.nextAudio;
                
                // Ajustar volumen final
                this.state.currentAudio.volume = this.state.volume;
                
                // OBTENER NUEVO NDICE ALEATORIO PARA LA SIGUIENTE CANCIN
                this.state.currentTrackIndex = this.state.nextTrackIndex;
                
                if (this.config.shuffleMode) {
                    // Modo aleatorio activado
                    do {
                        this.state.nextTrackIndex = this.getRandomTrackIndex();
                    } while (this.state.nextTrackIndex === this.state.currentTrackIndex);
                } else {
                    // Modo secuencial
                    this.state.nextTrackIndex = (this.state.nextTrackIndex + 1) % this.state.tracks.length;
                }
                
                // Crear nuevo elemento para siguiente canci贸n
                this.state.nextAudio = new Audio();
                this.state.nextAudio.crossOrigin = "anonymous";
                this.state.nextAudio.preload = "auto";
                this.state.nextAudio.volume = 0;
                this.setupAudioEvents(this.state.nextAudio, 'next');
                
                // Cargar nueva siguiente canci贸n (aleatoria o secuencial)
                const nextTrack = this.state.tracks[this.state.nextTrackIndex];
                this.state.nextAudio.src = nextTrack.url;
                
                // Actualizar informaci贸n de UI
                const currentTrack = this.state.tracks[this.state.currentTrackIndex];
                this.updateTrackInfo(currentTrack);
                this.elements.nextTrackName.textContent = nextTrack.name;
                
                // Actualizar colores del 谩lbum
                this.updateAlbumArtColors();
                
                // Limpiar elemento antiguo
                setTimeout(() => {
                    if (oldCurrent) {
                        oldCurrent.src = '';
                        oldCurrent.load();
                    }
                }, 1000);
                
                // Reiniciar estado
                this.state.isCrossfading = false;
                this.state.crossfadeProgress = 0;
                this.elements.crossfadeProgress.style.width = '0%';
                this.elements.fadePercentage.textContent = '0%';
                this.elements.currentFadeStatus.textContent = 'Sistema de crossfade activo';
                
                // Programar siguiente transici贸n
                this.scheduleCrossfade();
            }

            nextTrack() {
                // Saltar a siguiente canci贸n (para manejo de errores)
                if (this.config.shuffleMode) {
                    this.state.currentTrackIndex = this.getRandomTrackIndex();
                    this.state.nextTrackIndex = this.getRandomTrackIndex();
                    
                    // Asegurar que no sean la misma
                    while (this.state.nextTrackIndex === this.state.currentTrackIndex) {
                        this.state.nextTrackIndex = this.getRandomTrackIndex();
                    }
                } else {
                    this.state.currentTrackIndex = (this.state.currentTrackIndex + 1) % this.state.tracks.length;
                    this.state.nextTrackIndex = (this.state.currentTrackIndex + 1) % this.state.tracks.length;
                }
                
                // Recargar tracks
                this.loadTrack(this.state.currentTrackIndex, 'current');
                this.loadTrack(this.state.nextTrackIndex, 'next');
                
                // Continuar reproducci贸n si estaba activa
                if (this.state.isPlaying) {
                    setTimeout(() => {
                        this.playCurrentTrack();
                    }, 1000);
                }
            }

            // ============== CONTROLES DE USUARIO ==============
            togglePower() {
                this.state.isPoweredOn = !this.state.isPoweredOn;
                
                if (this.state.isPoweredOn) {
                    // Encender radio - INICIAR CON CANCIN ALEATORIA SI EL MODO EST ACTIVADO
                    this.elements.powerBtn.classList.remove('off');
                    
                    // Si est谩 en modo aleatorio, seleccionar nueva canci贸n aleatoria
                    if (this.config.shuffleMode) {
                        this.state.currentTrackIndex = this.getRandomTrackIndex();
                        
                        // Obtener siguiente canci贸n aleatoria diferente
                        do {
                            this.state.nextTrackIndex = this.getRandomTrackIndex();
                        } while (this.state.nextTrackIndex === this.state.currentTrackIndex);
                        
                        // Cargar nueva canci贸n aleatoria
                        this.loadTrack(this.state.currentTrackIndex, 'current').then(() => {
                            this.loadTrack(this.state.nextTrackIndex, 'next').then(() => {
                                this.playCurrentTrack();
                            });
                        });
                    } else {
                        // Modo secuencial
                        this.playCurrentTrack();
                    }
                    
                    this.showNotification('Emisora activada', 'Reproducci贸n continua iniciada', 'success');
                } else {
                    // Apagar radio
                    this.elements.powerBtn.classList.add('off');
                    this.state.currentAudio.pause();
                    this.state.isPlaying = false;
                    this.elements.albumArt.classList.remove('playing');
                    
                    this.elements.broadcastStatus.className = 'status-indicator status-offline';
                    this.elements.broadcastStatus.innerHTML = '<i class="fas fa-circle" style="font-size: 0.8rem;"></i><span>EMISORA APAGADA</span>';
                    
                    this.showNotification('Emisora apagada', 'Reproducci贸n detenida', 'info');
                }
            }

            setVolume(value) {
                this.state.volume = Math.max(0, Math.min(1, value));
                
                // Aplicar volumen solo a la canci贸n actual (la siguiente est谩 en 0 hasta crossfade)
                if (this.state.currentAudio) {
                    this.state.currentAudio.volume = this.state.volume;
                }
                
                // Actualizar UI
                const percentage = Math.round(this.state.volume * 100);
                this.elements.volumeValue.textContent = percentage + '%';
                this.elements.volumeSlider.value = percentage;
                
                // Actualizar icono de volumen
                let icon = 'fa-volume-up';
                if (percentage === 0) icon = 'fa-volume-mute';
                else if (percentage < 30) icon = 'fa-volume-down';
                else if (percentage < 70) icon = 'fa-volume-low';
                
                this.elements.volumeIcon.className = 'fas ' + icon;
            }

            // ============== ACTUALIZACIN DE UI ==============
            updateUI() {
                if (!this.state.currentAudio || !this.state.isPlaying) return;
                
                const currentTime = this.state.currentAudio.currentTime;
                const duration = this.state.currentAudio.duration || 1;
                const progress = (currentTime / duration) * 100;
                
                // Actualizar barras de progreso
                this.elements.progressFill.style.width = progress + '%';
                
                // Actualizar tiempos
                this.elements.currentTime.textContent = this.formatTime(currentTime);
                this.elements.progressCurrent.textContent = this.formatTime(currentTime);
                
                if (duration && !isNaN(duration)) {
                    this.elements.trackDuration.textContent = this.formatTime(duration);
                    this.elements.progressTotal.textContent = this.formatTime(duration);
                    this.elements.timeRemaining.textContent = '-' + this.formatTime(duration - currentTime);
                }
            }

            updateBroadcastTime() {
                if (!this.state.isPlaying) return;
                
                const elapsed = Date.now() - this.state.broadcastStartTime;
                const hours = Math.floor(elapsed / 3600000);
                const minutes = Math.floor((elapsed % 3600000) / 60000);
                const seconds = Math.floor((elapsed % 60000) / 1000);
                
                let timeStr = '';
                if (hours > 0) {
                    timeStr = hours.toString().padStart(2, '0') + ':' + 
                             minutes.toString().padStart(2, '0') + ':' + 
                             seconds.toString().padStart(2, '0');
                } else {
                    timeStr = minutes.toString().padStart(2, '0') + ':' + 
                             seconds.toString().padStart(2, '0');
                }
                
                this.elements.broadcastTime.textContent = timeStr;
            }

            updateNextChangeTime(timeUntilFade) {
                if (timeUntilFade <= 0) return;
                
                const minutes = Math.floor(timeUntilFade / 60000);
                const seconds = Math.floor((timeUntilFade % 60000) / 1000);
                
                this.elements.nextChange.textContent = `Pr贸ximo cambio autom谩tico en: ${minutes}:${seconds.toString().padStart(2, '0')}`;
                this.elements.nextTrackTime.textContent = `En ${minutes}:${seconds.toString().padStart(2, '0')}`;
                this.elements.nextIn.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            }

            updateAlbumArtColors() {
                // Generar colores 煤nicos para cada canci贸n
                const hue = (this.state.currentTrackIndex * 137) % 360;
                const color1 = `hsl(${hue}, 80%, 45%)`;
                const color2 = `hsl(${(hue + 60) % 360}, 80%, 45%)`;
                
                this.elements.albumArt.style.background = `linear-gradient(135deg, ${color1}, ${color2})`;
            }

            formatTime(seconds) {
                if (isNaN(seconds)) return '00:00';
                
                const mins = Math.floor(seconds / 60);
                const secs = Math.floor(seconds % 60);
                return mins.toString().padStart(2, '0') + ':' + secs.toString().padStart(2, '0');
            }

            // ============== EVENT HANDLERS ==============
            onTrackLoaded(type) {
                if (type === 'current') {
                    const track = this.state.tracks[this.state.currentTrackIndex];
                    if (track) {
                        track.duration = this.state.currentAudio.duration;
                    }
                }
            }

            onAudioError(error, type) {
                console.error(`Error en audio ${type}:`, error);
                
                if (type === 'current') {
                    this.showNotification('Error de reproducci贸n', 'Saltando a siguiente canci贸n...', 'warning');
                    
                    // Saltar a siguiente canci贸n
                    setTimeout(() => {
                        this.nextTrack();
                    }, 1000);
                }
            }

            onTrackEnded(type) {
                if (type === 'current' && !this.state.isCrossfading) {
                    // Si termina sin crossfade (fallback)
                    this.nextTrack();
                }
            }

            onCanPlay(type) {
                if (type === 'next') {
                    console.log('Siguiente canci贸n lista para reproducir');
                }
            }

            // ============== NOTIFICACIONES ==============
            showNotification(title, message, type = 'info') {
                this.elements.notificationTitle.textContent = title;
                this.elements.notificationMessage.textContent = message;
                
                // Configurar color seg煤n tipo
                let borderColor = '#1a73e8';
                if (type === 'success') borderColor = '#34a853';
                if (type === 'error') borderColor = '#ea4335';
                if (type === 'warning') borderColor = '#fbbc05';
                
                this.elements.notification.style.borderLeftColor = borderColor;
                
                // Mostrar notificaci贸n
                this.elements.notification.classList.add('show');
                
                // Ocultar despu茅s de 3 segundos
                setTimeout(() => {
                    this.elements.notification.classList.remove('show');
                }, 3000);
            }

            // ============== LOADING ==============
            updateLoadingStatus(message) {
                if (this.elements.loadingDetails) {
                    this.elements.loadingDetails.textContent = message;
                }
            }

            hideLoadingScreen() {
                setTimeout(() => {
                    this.elements.loadingScreen.style.opacity = '0';
                    
                    setTimeout(() => {
                        this.elements.loadingScreen.style.display = 'none';
                        this.elements.app.style.display = 'block';
                        
                        setTimeout(() => {
                            this.elements.app.classList.add('app-loaded');
                        }, 50);
                    }, 500);
                }, 1000);
            }
        }

        // ============== INICIAR SISTEMA ==============
        document.addEventListener('DOMContentLoaded', () => {
            window.radioSystem = new RadioOnlineSystem();
        });
    </script>
</body>
</html>
