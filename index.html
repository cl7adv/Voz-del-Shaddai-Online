<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Radio Shaddai - Emisora Cristiana</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(rgba(0, 0, 0, 0.8), rgba(0, 0, 0, 0.8)),
                        url('https://images.unsplash.com/photo-1506905925346-21bda4d32df4?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: white;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .radio-container {
            width: 100%;
            max-width: 600px;
            background: rgba(0, 0, 0, 0.85);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border: 2px solid rgba(255, 255, 255, 0.1);
            text-align: center;
        }

        .radio-header {
            margin-bottom: 30px;
        }

        .radio-header h1 {
            font-size: 2.5rem;
            color: #4CAF50;
            margin-bottom: 10px;
        }

        .radio-header p {
            font-size: 1.1rem;
            opacity: 0.9;
            color: #64B5F6;
        }

        .radio-icon {
            font-size: 4rem;
            color: #4CAF50;
            margin: 20px 0;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .now-playing {
            background: rgba(76, 175, 80, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin: 25px 0;
            border-left: 5px solid #4CAF50;
        }

        .now-playing h3 {
            color: #4CAF50;
            margin-bottom: 15px;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 10px;
            justify-content: center;
        }

        .song-title {
            font-size: 1.4rem;
            font-weight: bold;
            margin-bottom: 8px;
            color: white;
            min-height: 30px;
        }

        .song-info {
            font-size: 0.9rem;
            opacity: 0.8;
            color: #64B5F6;
        }

        .controls {
            display: flex;
            flex-direction: column;
            gap: 25px;
            margin-top: 30px;
        }

        .power-control {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        .power-btn {
            background: linear-gradient(to right, #f44336, #d32f2f);
            border: none;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            color: white;
            font-size: 1.8rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(244, 67, 54, 0.4);
        }

        .power-btn:hover {
            transform: scale(1.05);
        }

        .power-btn.on {
            background: linear-gradient(to right, #4CAF50, #388E3C);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4);
        }

        .volume-control {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        .volume-control label {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.1rem;
            color: #4CAF50;
        }

        .volume-slider {
            width: 100%;
            height: 8px;
            -webkit-appearance: none;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            outline: none;
        }

        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 22px;
            height: 22px;
            background: #4CAF50;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }

        .status {
            margin-top: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.8);
        }

        .song-counter {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .footer {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
        }

        .loading {
            display: none;
            color: #64B5F6;
            font-style: italic;
            margin: 10px 0;
        }

        .error {
            display: none;
            color: #f44336;
            background: rgba(244, 67, 54, 0.1);
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }

        .playing-indicator {
            display: inline-block;
            margin-left: 10px;
            color: #4CAF50;
            animation: playing 1.5s infinite;
        }

        @keyframes playing {
            0% { opacity: 0.5; }
            50% { opacity: 1; }
            100% { opacity: 0.5; }
        }

        @media (max-width: 600px) {
            .radio-container {
                padding: 20px;
            }
            
            .radio-header h1 {
                font-size: 2rem;
            }
            
            .radio-icon {
                font-size: 3rem;
            }
            
            .song-title {
                font-size: 1.2rem;
            }
        }
    </style>
</head>
<body>
    <div class="radio-container">
        <div class="radio-header">
            <h1><i class="fas fa-broadcast-tower"></i> Radio Shaddai</h1>
            <p>Emisora Cristiana Online</p>
        </div>

        <div class="radio-icon">
            <i class="fas fa-music"></i>
        </div>

        <div class="now-playing">
            <h3><i class="fas fa-headphones"></i> Reproduciendo ahora:</h3>
            <div class="song-title" id="songTitle">Bienvenido a Radio Shaddai</div>
            <div class="song-info" id="songInfo">Cargando música desde GitHub...</div>
        </div>

        <div class="controls">
            <div class="power-control">
                <button class="power-btn" id="powerBtn">
                    <i class="fas fa-power-off"></i>
                </button>
                <div id="powerStatus">Presiona para encender</div>
            </div>

            <div class="volume-control">
                <label for="volumeSlider">
                    <i class="fas fa-volume-up"></i> Volumen
                </label>
                <input type="range" min="0" max="100" value="70" class="volume-slider" id="volumeSlider">
            </div>
        </div>

        <div class="loading" id="loading">Cargando música...</div>
        <div class="error" id="error"></div>

        <div class="status" id="status">
            <i class="fas fa-info-circle"></i> Conectando a la biblioteca de música...
        </div>

        <div class="song-counter">
            <span>Canciones cargadas: <span id="songCount">0</span></span>
            <span>Modo: Aleatorio</span>
        </div>

        <div class="footer">
            <p><i class="fas fa-cross" style="color: #4CAF50;"></i> Música Cristiana desde GitHub</p>
            <p>Biblioteca: github.com/cl7adv/Voz-del-Shaddai-Online/musica</p>
        </div>
    </div>

    <script>
        // Variables globales
        let audioPlayer = new Audio();
        let isPlaying = false;
        let isPoweredOn = false;
        let currentVolume = 0.7;
        let allSongs = [];
        let currentSongIndex = 0;
        let retryCount = 0;
        const maxRetries = 3;

        // Elementos del DOM
        const powerBtn = document.getElementById('powerBtn');
        const powerStatus = document.getElementById('powerStatus');
        const volumeSlider = document.getElementById('volumeSlider');
        const songTitle = document.getElementById('songTitle');
        const songInfo = document.getElementById('songInfo');
        const loadingEl = document.getElementById('loading');
        const errorEl = document.getElementById('error');
        const statusEl = document.getElementById('status');
        const songCountEl = document.getElementById('songCount');

        // URL base de la biblioteca de música en GitHub
        const GITHUB_REPO = 'https://github.com/cl7adv/Voz-del-Shaddai-Online/tree/main/musica';
        const GITHUB_RAW_BASE = 'https://raw.githubusercontent.com/cl7adv/Voz-del-Shaddai-Online/main/musica/';

        // Lista de canciones que sabemos que existen (podemos detectar más después)
        const knownSongs = [
            'Generación 12 - Quiero Conocer A Jesús (Yeshua) Nuestro Dios I VIDEO OFICIAL I Música Cristiana 2022.mp3',
            'Alabanza y Adoración 1.mp3',
            'Alabanza y Adoración 2.mp3',
            'Bendecid Su Nombre.mp3',
            'Canto de Victoria.mp3',
            'Celebrad a Cristo.mp3',
            'Coritos 1.mp3',
            'Coritos 2.mp3',
            'Cuan Grande Es El.mp3',
            'Digno Es El Cordero.mp3',
            'El Poder de la Cruz.mp3',
            'En La Cruz.mp3',
            'Getsemani.mp3',
            'Gloria a Dios.mp3',
            'Grande Es Tu Fidelidad.mp3',
            'Hay Poder.mp3',
            'Himno a la Santísima Trinidad.mp3',
            'Hosanna.mp3',
            'La Tierra Canta.mp3',
            'Mi Vida Esta en Ti.mp3',
            'No Hay Dios Tan Grande.mp3',
            'Padre Nuestro.mp3',
            'Paz en la Tormenta.mp3',
            'Puedes Confiar.mp3',
            'Renuévame.mp3',
            'Santo Santo Santo.mp3',
            'Te Alabamos Señor.mp3',
            'Tu Fidelidad.mp3',
            'Ven Espíritu Santo.mp3'
        ];

        // Función para cargar canciones desde GitHub
        async function loadSongsFromGitHub() {
            try {
                showLoading("Buscando música en GitHub...");
                errorEl.style.display = 'none';
                
                // Intentar cargar usando GitHub API
                const apiUrl = 'https://api.github.com/repos/cl7adv/Voz-del-Shaddai-Online/contents/musica';
                
                let response;
                try {
                    response = await fetch(apiUrl);
                    
                    if (!response.ok) {
                        throw new Error(`API error: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    
                    // Filtrar archivos de audio
                    const audioFiles = data.filter(item => 
                        item.type === 'file' && 
                        (item.name.toLowerCase().endsWith('.mp3') || 
                         item.name.toLowerCase().endsWith('.wav') || 
                         item.name.toLowerCase().endsWith('.ogg') ||
                         item.name.toLowerCase().endsWith('.m4a'))
                    );
                    
                    if (audioFiles.length > 0) {
                        // Crear lista de canciones desde la API
                        allSongs = audioFiles.map((file, index) => {
                            const fileName = file.name;
                            const songName = fileName.replace(/\.[^/.]+$/, "").replace(/_/g, " ").replace(/-/g, " ");
                            const url = GITHUB_RAW_BASE + encodeURIComponent(fileName);
                            
                            return {
                                id: index,
                                title: songName,
                                url: url,
                                filename: fileName
                            };
                        });
                        
                        hideLoading();
                        statusEl.innerHTML = `<i class="fas fa-check-circle"></i> ${allSongs.length} canciones encontradas`;
                        updateSongCount();
                        return true;
                    }
                } catch (apiError) {
                    console.log("API falló, usando lista local:", apiError);
                }
                
                // Si la API falla, usar la lista local de canciones conocidas
                allSongs = knownSongs.map((filename, index) => {
                    const songName = filename.replace(/\.[^/.]+$/, "").replace(/_/g, " ").replace(/-/g, " ");
                    const url = GITHUB_RAW_BASE + encodeURIComponent(filename);
                    
                    return {
                        id: index,
                        title: songName,
                        url: url,
                        filename: filename
                    };
                });
                
                // Verificar qué canciones realmente existen
                await verifySongsExist();
                
                hideLoading();
                statusEl.innerHTML = `<i class="fas fa-info-circle"></i> ${allSongs.length} canciones disponibles`;
                updateSongCount();
                return true;
                
            } catch (error) {
                console.error("Error cargando canciones:", error);
                errorEl.textContent = "Error cargando música. Usando lista básica...";
                errorEl.style.display = 'block';
                
                // Usar lista mínima como respaldo
                loadBackupSongs();
                return false;
            }
        }

        // Función para verificar qué canciones realmente existen
        async function verifySongsExist() {
            if (allSongs.length === 0) return;
            
            const verifiedSongs = [];
            
            // Probar las primeras 5 canciones para verificar conexión
            const testSongs = allSongs.slice(0, Math.min(5, allSongs.length));
            
            for (const song of testSongs) {
                try {
                    const testResponse = await fetch(song.url, { method: 'HEAD' });
                    if (testResponse.ok) {
                        verifiedSongs.push(song);
                    }
                } catch (e) {
                    console.log(`Canción no disponible: ${song.title}`);
                }
            }
            
            // Si encontramos al menos una canción que funcione, usamos todas
            if (verifiedSongs.length > 0) {
                statusEl.innerHTML = `<i class="fas fa-check-circle"></i> ${allSongs.length} canciones listas`;
            } else {
                // Si ninguna funciona, usar solo una canción de respaldo
                loadBackupSongs();
            }
        }

        // Función para cargar canciones de respaldo
        function loadBackupSongs() {
            allSongs = [
                {
                    id: 0,
                    title: "Generación 12 - Quiero Conocer A Jesús (Yeshua)",
                    url: GITHUB_RAW_BASE + "Generación%2012%20-%20Quiero%20Conocer%20A%20Jesús%20(Yeshua)%20Nuestro%20Dios%20I%20VIDEO%20OFICIAL%20I%20Música%20Cristiana%202022.mp3",
                    filename: "Generación 12 - Quiero Conocer A Jesús (Yeshua) Nuestro Dios I VIDEO OFICIAL I Música Cristiana 2022.mp3"
                }
            ];
            
            updateSongCount();
            statusEl.innerHTML = `<i class="fas fa-exclamation-triangle"></i> Usando música de respaldo`;
        }

        // Función para mezclar canciones aleatoriamente
        function shuffleSongs() {
            for (let i = allSongs.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [allSongs[i], allSongs[j]] = [allSongs[j], allSongs[i]];
            }
        }

        // Función para obtener la siguiente canción
        function getNextSong() {
            if (allSongs.length === 0) return null;
            
            currentSongIndex = (currentSongIndex + 1) % allSongs.length;
            return allSongs[currentSongIndex];
        }

        // Función para reproducir canción actual
        async function playCurrentSong() {
            if (!isPoweredOn || allSongs.length === 0) return;
            
            const song = allSongs[currentSongIndex];
            
            showLoading(`Cargando: ${song.title}...`);
            
            // Detener audio actual
            audioPlayer.pause();
            audioPlayer.currentTime = 0;
            
            // Asignar nueva fuente
            audioPlayer.src = song.url;
            
            // Reproducir
            try {
                const playPromise = audioPlayer.play();
                
                if (playPromise !== undefined) {
                    await playPromise;
                    
                    isPlaying = true;
                    songTitle.innerHTML = song.title + ' <span class="playing-indicator"><i class="fas fa-volume-up"></i></span>';
                    songInfo.textContent = "Reproduciendo...";
                    hideLoading();
                    errorEl.style.display = 'none';
                    
                    statusEl.innerHTML = `<i class="fas fa-play-circle"></i> Reproduciendo: ${song.title}`;
                }
            } catch (error) {
                console.error("Error al reproducir:", error);
                hideLoading();
                
                if (error.name === 'NotAllowedError') {
                    errorEl.textContent = "Haz clic en el botón de encender para comenzar.";
                    errorEl.style.display = 'block';
                } else {
                    errorEl.textContent = `Error al cargar "${song.title}". Intentando siguiente canción...`;
                    errorEl.style.display = 'block';
                    
                    // Reintentar o pasar a la siguiente
                    retryCount++;
                    if (retryCount < maxRetries) {
                        setTimeout(() => {
                            playNextSong();
                        }, 2000);
                    } else {
                        retryCount = 0;
                        playNextSong();
                    }
                }
            }
        }

        // Función para reproducir siguiente canción
        function playNextSong() {
            if (allSongs.length === 0) return;
            
            getNextSong();
            playCurrentSong();
        }

        // Función para alternar encendido/apagado
        async function togglePower() {
            isPoweredOn = !isPoweredOn;
            
            if (isPoweredOn) {
                // Encender
                powerBtn.classList.add('on');
                powerStatus.textContent = "Radio encendida";
                powerStatus.style.color = "#4CAF50";
                
                // Si no hay canciones cargadas, cargarlas
                if (allSongs.length === 0) {
                    await loadSongsFromGitHub();
                }
                
                // Mezclar canciones al azar
                shuffleSongs();
                currentSongIndex = 0;
                
                // Comenzar a reproducir
                playCurrentSong();
                
            } else {
                // Apagar
                powerBtn.classList.remove('on');
                powerStatus.textContent = "Radio apagada";
                powerStatus.style.color = "#f44336";
                
                // Detener reproducción
                audioPlayer.pause();
                isPlaying = false;
                
                songTitle.textContent = "Radio Shaddai";
                songInfo.textContent = "Emisora apagada";
                
                statusEl.innerHTML = `<i class="fas fa-power-off"></i> Radio apagada`;
            }
        }

        // Función para actualizar volumen
        function updateVolume(volume) {
            currentVolume = volume / 100;
            audioPlayer.volume = currentVolume;
        }

        // Función para actualizar contador de canciones
        function updateSongCount() {
            songCountEl.textContent = allSongs.length;
        }

        // Función para mostrar carga
        function showLoading(message) {
            loadingEl.textContent = message;
            loadingEl.style.display = 'block';
        }

        // Función para ocultar carga
        function hideLoading() {
            loadingEl.style.display = 'none';
        }

        // Inicializar eventos
        function initEvents() {
            // Botón de encendido/apagado
            powerBtn.addEventListener('click', togglePower);
            
            // Control de volumen
            volumeSlider.addEventListener('input', () => {
                updateVolume(volumeSlider.value);
            });
            
            // Configurar audio player
            audioPlayer.volume = currentVolume;
            audioPlayer.addEventListener('ended', playNextSong);
            
            audioPlayer.addEventListener('error', function(e) {
                console.error("Error de audio:", e);
                errorEl.textContent = "Error de audio. Saltando a la siguiente canción...";
                errorEl.style.display = 'block';
                playNextSong();
            });
        }

        // Inicializar cuando cargue la página
        window.addEventListener('DOMContentLoaded', async function() {
            // Inicializar eventos
            initEvents();
            
            // Cargar canciones automáticamente
            await loadSongsFromGitHub();
            
            // Mostrar estado inicial
            statusEl.innerHTML = `<i class="fas fa-music"></i> Listo para reproducir música cristiana`;
        });
    </script>
</body>
</html>
